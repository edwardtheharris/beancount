
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>beancount.parser.printer &#8212; Beancount 2.2.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for beancount.parser.printer</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Conversion from internal data structures to text.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) 2014-2018  Martin Blais&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;GNU GPLv2&quot;</span>

<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">textwrap</span>

<span class="kn">from</span> <span class="nn">beancount.core.number</span> <span class="k">import</span> <span class="n">Decimal</span>
<span class="kn">from</span> <span class="nn">beancount.core</span> <span class="k">import</span> <span class="n">position</span>
<span class="kn">from</span> <span class="nn">beancount.core</span> <span class="k">import</span> <span class="n">convert</span>
<span class="kn">from</span> <span class="nn">beancount.core</span> <span class="k">import</span> <span class="n">inventory</span>
<span class="kn">from</span> <span class="nn">beancount.core</span> <span class="k">import</span> <span class="n">amount</span>
<span class="kn">from</span> <span class="nn">beancount.core</span> <span class="k">import</span> <span class="n">account</span>
<span class="kn">from</span> <span class="nn">beancount.core</span> <span class="k">import</span> <span class="n">data</span>
<span class="kn">from</span> <span class="nn">beancount.core</span> <span class="k">import</span> <span class="n">interpolate</span>
<span class="kn">from</span> <span class="nn">beancount.core</span> <span class="k">import</span> <span class="n">display_context</span>
<span class="kn">from</span> <span class="nn">beancount.utils</span> <span class="k">import</span> <span class="n">misc_utils</span>


<div class="viewcode-block" id="align_position_strings"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.align_position_strings">[docs]</a><span class="k">def</span> <span class="nf">align_position_strings</span><span class="p">(</span><span class="n">strings</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A helper used to align rendered amounts positions to their first currency</span>
<span class="sd">    character (an uppercase letter). This class accepts a list of rendered</span>
<span class="sd">    positions and calculates the necessary width to render them stacked in a</span>
<span class="sd">    column so that the first currency word aligns. It does not go beyond that</span>
<span class="sd">    (further currencies, e.g. for the price or cost, are not aligned).</span>

<span class="sd">    This is perhaps best explained with an example. The following positions will</span>
<span class="sd">    be aligned around the column marked with &#39;^&#39;:</span>

<span class="sd">              45 HOOL {504.30 USD}</span>
<span class="sd">               4 HOOL {504.30 USD, 2014-11-11}</span>
<span class="sd">            9.95 USD</span>
<span class="sd">       -22473.32 CAD @ 1.10 USD</span>
<span class="sd">                 ^</span>

<span class="sd">    Strings without a currency character will be rendered flush left.</span>

<span class="sd">    Args:</span>
<span class="sd">      strings: A list of rendered position or amount strings.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A pair of a list of aligned strings and the width of the aligned strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Maximum length before the alignment character.</span>
    <span class="n">max_before</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Maximum length after the alignment character.</span>
    <span class="n">max_after</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Maximum length of unknown strings.</span>
    <span class="n">max_unknown</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">string_items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[A-Z]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">search</span>
    <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">max_before</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">max_before</span><span class="p">)</span>
                <span class="n">max_after</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">-</span> <span class="n">index</span><span class="p">,</span> <span class="n">max_after</span><span class="p">)</span>
                <span class="n">string_items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">index</span><span class="p">,</span> <span class="n">string</span><span class="p">))</span>
                <span class="k">continue</span>
        <span class="c1"># else</span>
        <span class="n">max_unknown</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">),</span> <span class="n">max_unknown</span><span class="p">)</span>
        <span class="n">string_items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="n">string</span><span class="p">))</span>

    <span class="c1"># Compute formatting string.</span>
    <span class="n">max_total</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_before</span> <span class="o">+</span> <span class="n">max_after</span><span class="p">,</span> <span class="n">max_unknown</span><span class="p">)</span>
    <span class="n">max_after_prime</span> <span class="o">=</span> <span class="n">max_total</span> <span class="o">-</span> <span class="n">max_before</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;{{:&gt;</span><span class="si">{0}</span><span class="s2">}}{{:</span><span class="si">{1}</span><span class="s2">}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_before</span><span class="p">,</span> <span class="n">max_after_prime</span><span class="p">)</span><span class="o">.</span><span class="n">format</span>
    <span class="n">fmt_unknown</span> <span class="o">=</span> <span class="s2">&quot;{{:&lt;</span><span class="si">{0}</span><span class="s2">}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_total</span><span class="p">)</span><span class="o">.</span><span class="n">format</span>

    <span class="c1"># Align the strings and return them.</span>
    <span class="n">aligned_strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">string_items</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">(</span><span class="n">string</span><span class="p">[:</span><span class="n">index</span><span class="p">],</span> <span class="n">string</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">fmt_unknown</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="n">aligned_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">aligned_strings</span><span class="p">,</span> <span class="n">max_total</span></div>


<div class="viewcode-block" id="EntryPrinter"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter">[docs]</a><span class="k">class</span> <span class="nc">EntryPrinter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A multi-method interface for printing all directive types.</span>

<span class="sd">    Atributes:</span>
<span class="sd">      dcontext: An instance of DisplayContext with which to render all the numbers.</span>
<span class="sd">      render_weight: A boolean, true if we should render the weight of the postings</span>
<span class="sd">        as a comment, for debugging.</span>
<span class="sd">      min_width_account: An integer, the minimum width to leave for the account name.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=invalid-name</span>

<div class="viewcode-block" id="EntryPrinter.__init__"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_width_account</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dcontext</span> <span class="o">=</span> <span class="n">dcontext</span> <span class="ow">or</span> <span class="n">display_context</span><span class="o">.</span><span class="n">DEFAULT_DISPLAY_CONTEXT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dformat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcontext</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="n">display_context</span><span class="o">.</span><span class="n">Precision</span><span class="o">.</span><span class="n">MOST_COMMON</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dformat_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcontext</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="n">display_context</span><span class="o">.</span><span class="n">Precision</span><span class="o">.</span><span class="n">MAXIMUM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render_weight</span> <span class="o">=</span> <span class="n">render_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_width_account</span> <span class="o">=</span> <span class="n">min_width_account</span></div>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Render a directive.</span>

<span class="sd">        Args:</span>
<span class="sd">          obj: The directive to be rendered.</span>
<span class="sd">        Returns:</span>
<span class="sd">          A string, the rendered directive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">method</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

    <span class="n">META_IGNORE</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;lineno&#39;</span><span class="p">,</span> <span class="s1">&#39;__automatic__&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="EntryPrinter.write_metadata"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.write_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">write_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;  &#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write metadata to the file object, excluding filename and line number.</span>

<span class="sd">        Args:</span>
<span class="sd">          meta: A dict that contains the metadata for this directive.</span>
<span class="sd">          oss: A file object to write to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">META_IGNORE</span><span class="p">:</span>
                <span class="n">value_str</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">value_str</span> <span class="o">=</span> <span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">escape_string</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">)):</span>
                    <span class="n">value_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="n">value_str</span> <span class="o">=</span> <span class="s1">&#39;TRUE&#39;</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="s1">&#39;FALSE&#39;</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">inventory</span><span class="o">.</span><span class="n">Inventory</span><span class="p">)):</span>
                    <span class="k">pass</span> <span class="c1"># Ignore dicts, don&#39;t print them out.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected value: &#39;</span><span class="si">{!r}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">value_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}{}</span><span class="s2">: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_str</span><span class="p">))</span></div>

<div class="viewcode-block" id="EntryPrinter.Transaction"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.Transaction">[docs]</a>    <span class="k">def</span> <span class="nf">Transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">oss</span><span class="p">):</span>
        <span class="c1"># Compute the string for the payee and narration line.</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">payee</span><span class="p">:</span>
            <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">escape_string</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">payee</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">narration</span><span class="p">:</span>
            <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">misc_utils</span><span class="o">.</span><span class="n">escape_string</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">narration</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">payee</span><span class="p">:</span>
            <span class="c1"># Ensure we append an empty string for narration if we have a payee.</span>
            <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">tags</span><span class="p">):</span>
                <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">links</span><span class="p">):</span>
                <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;^</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">link</span><span class="p">))</span>

        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{e.date}</span><span class="s1"> </span><span class="si">{e.flag}</span><span class="s1"> </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">),</span> <span class="n">e</span><span class="o">=</span><span class="n">entry</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">render_posting_strings</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">posting</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">]</span>
        <span class="n">strs_account</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>
        <span class="n">width_account</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flag_account</span><span class="p">)</span> <span class="k">for</span> <span class="n">flag_account</span> <span class="ow">in</span> <span class="n">strs_account</span><span class="p">)</span>
                         <span class="k">if</span> <span class="n">strs_account</span>
                         <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">strs_position</span><span class="p">,</span> <span class="n">width_position</span> <span class="o">=</span> <span class="n">align_position_strings</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">)</span>
        <span class="n">strs_weight</span><span class="p">,</span> <span class="n">width_weight</span> <span class="o">=</span> <span class="n">align_position_strings</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_width_account</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_width_account</span> <span class="o">&gt;</span> <span class="n">width_account</span><span class="p">:</span>
            <span class="n">width_account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_width_account</span>

        <span class="n">non_trivial_balance</span> <span class="o">=</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">interpolate</span><span class="o">.</span><span class="n">has_nontrivial_balance</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">))</span>
                               <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_weight</span>
                               <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">non_trivial_balance</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;  {{:</span><span class="si">{0}</span><span class="s2">}}  {{:</span><span class="si">{1}</span><span class="s2">}}  ; {{:</span><span class="si">{2}</span><span class="s2">}}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">width_account</span><span class="p">,</span> <span class="n">width_position</span><span class="p">,</span> <span class="n">width_weight</span><span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="k">for</span> <span class="n">posting</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">position_str</span><span class="p">,</span> <span class="n">weight_str</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">,</span>
                                                                  <span class="n">strs_account</span><span class="p">,</span>
                                                                  <span class="n">strs_position</span><span class="p">,</span>
                                                                  <span class="n">strs_weight</span><span class="p">):</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmt</span><span class="p">(</span><span class="n">account</span><span class="p">,</span>
                              <span class="n">position_str</span><span class="p">,</span>
                              <span class="n">weight_str</span> <span class="k">if</span> <span class="n">non_trivial_balance</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">,</span> <span class="s1">&#39;    &#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmt_str</span> <span class="o">=</span> <span class="s2">&quot;  {{:</span><span class="si">{0}</span><span class="s2">}}  {{:</span><span class="si">{1}</span><span class="s2">}}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width_account</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">width_position</span><span class="p">))</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt_str</span><span class="o">.</span><span class="n">format</span>
            <span class="k">for</span> <span class="n">posting</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">position_str</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">postings</span><span class="p">,</span>
                                                      <span class="n">strs_account</span><span class="p">,</span>
                                                      <span class="n">strs_position</span><span class="p">):</span>
                <span class="c1"># pylint: disable=too-many-format-args</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmt</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">position_str</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">,</span> <span class="s1">&#39;    &#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntryPrinter.render_posting_strings"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.render_posting_strings">[docs]</a>    <span class="k">def</span> <span class="nf">render_posting_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posting</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This renders the three components of a posting: the account and its optional</span>
<span class="sd">        posting flag, the position, and finally, the weight of the position. The</span>
<span class="sd">        purpose is to align these in the caller.</span>

<span class="sd">        Args:</span>
<span class="sd">          posting: An instance of Posting, the posting to render.</span>
<span class="sd">        Returns:</span>
<span class="sd">          A tuple of</span>
<span class="sd">            flag_account: A string, the account name including the flag.</span>
<span class="sd">            position_str: A string, the rendered position string.</span>
<span class="sd">            weight_str: A string, the rendered weight of the posting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Render a string of the flag and the account.</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span> <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">flag</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">flag_account</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">+</span> <span class="n">posting</span><span class="o">.</span><span class="n">account</span>

        <span class="c1"># Render a string with the amount and cost and optional price, if</span>
        <span class="c1"># present. Also render a string with the weight.</span>
        <span class="n">weight_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">):</span>
            <span class="n">position_str</span> <span class="o">=</span> <span class="n">position</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">posting</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dformat</span><span class="p">)</span>
            <span class="c1"># Note: we render weights at maximum precision, for debugging.</span>
            <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">cost</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span> <span class="n">position</span><span class="o">.</span><span class="n">Cost</span><span class="p">)</span> <span class="ow">and</span>
                                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">cost</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)):</span>
                <span class="n">weight_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">convert</span><span class="o">.</span><span class="n">get_weight</span><span class="p">(</span><span class="n">posting</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">position_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">position_str</span> <span class="o">+=</span> <span class="s1">&#39; @ </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dformat_max</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">flag_account</span><span class="p">,</span> <span class="n">position_str</span><span class="p">,</span> <span class="n">weight_str</span></div>

<div class="viewcode-block" id="EntryPrinter.Posting"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.Posting">[docs]</a>    <span class="k">def</span> <span class="nf">Posting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posting</span><span class="p">,</span> <span class="n">oss</span><span class="p">):</span>
        <span class="c1"># Note: This is to be used when rendering postings directly only. The</span>
        <span class="c1"># method rendering a transaction attempts to align the posting strings</span>
        <span class="c1"># together.</span>
        <span class="n">flag_account</span><span class="p">,</span> <span class="n">position_str</span><span class="p">,</span> <span class="n">weight_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_posting_strings</span><span class="p">(</span><span class="n">posting</span><span class="p">)</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">{:64}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> ; </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flag_account</span><span class="p">,</span>
                                             <span class="n">position_str</span><span class="p">,</span>
                                             <span class="n">weight_str</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">posting</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">,</span> <span class="s1">&#39;    &#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntryPrinter.Balance"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.Balance">[docs]</a>    <span class="k">def</span> <span class="nf">Balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">oss</span><span class="p">):</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="s1">&#39;   ; Diff: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">diff_amount</span><span class="p">)</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">diff_amount</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s1">&#39;</span><span class="si">{e.date}</span><span class="s1"> balance </span><span class="si">{e.account:47}</span><span class="s1"> </span><span class="si">{amount}</span><span class="s1">&#39;</span>
                   <span class="s1">&#39;</span><span class="si">{comment}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">entry</span><span class="p">,</span>
                                         <span class="n">amount</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dformat</span><span class="p">),</span>
                                         <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntryPrinter.Note"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.Note">[docs]</a>    <span class="k">def</span> <span class="nf">Note</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">oss</span><span class="p">):</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{e.date}</span><span class="s1"> note </span><span class="si">{e.account}</span><span class="s1"> &quot;</span><span class="si">{e.comment}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">entry</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntryPrinter.Document"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.Document">[docs]</a>    <span class="k">def</span> <span class="nf">Document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">oss</span><span class="p">):</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{e.date}</span><span class="s1"> document </span><span class="si">{e.account}</span><span class="s1"> &quot;</span><span class="si">{e.filename}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">entry</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">tags</span> <span class="ow">or</span> <span class="n">entry</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">tags</span><span class="p">):</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">links</span><span class="p">):</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;^</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">link</span><span class="p">))</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntryPrinter.Pad"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.Pad">[docs]</a>    <span class="k">def</span> <span class="nf">Pad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">oss</span><span class="p">):</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{e.date}</span><span class="s1"> pad </span><span class="si">{e.account}</span><span class="s1"> </span><span class="si">{e.source_account}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">entry</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntryPrinter.Open"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.Open">[docs]</a>    <span class="k">def</span> <span class="nf">Open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">oss</span><span class="p">):</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{e.date}</span><span class="s1"> open </span><span class="si">{e.account:47}</span><span class="s1"> </span><span class="si">{currencies}</span><span class="s1"> </span><span class="si">{booking}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">e</span><span class="o">=</span><span class="n">entry</span><span class="p">,</span>
            <span class="n">currencies</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">currencies</span> <span class="ow">or</span> <span class="p">[]),</span>
            <span class="n">booking</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">booking</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                     <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">booking</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                     <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntryPrinter.Close"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.Close">[docs]</a>    <span class="k">def</span> <span class="nf">Close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">oss</span><span class="p">):</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{e.date}</span><span class="s1"> close </span><span class="si">{e.account}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">entry</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntryPrinter.Commodity"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.Commodity">[docs]</a>    <span class="k">def</span> <span class="nf">Commodity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">oss</span><span class="p">):</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{e.date}</span><span class="s1"> commodity </span><span class="si">{e.currency}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">entry</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntryPrinter.Price"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.Price">[docs]</a>    <span class="k">def</span> <span class="nf">Price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">oss</span><span class="p">):</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{e.date}</span><span class="s1"> price </span><span class="si">{e.currency:&lt;22}</span><span class="s1"> </span><span class="si">{amount:&gt;22}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">e</span><span class="o">=</span><span class="n">entry</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dformat_max</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntryPrinter.Event"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.Event">[docs]</a>    <span class="k">def</span> <span class="nf">Event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">oss</span><span class="p">):</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{e.date}</span><span class="s1"> event &quot;</span><span class="si">{e.type}</span><span class="s1">&quot; &quot;</span><span class="si">{e.description}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">entry</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntryPrinter.Query"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.Query">[docs]</a>    <span class="k">def</span> <span class="nf">Query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">oss</span><span class="p">):</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{e.date}</span><span class="s1"> query &quot;</span><span class="si">{e.name}</span><span class="s1">&quot; &quot;</span><span class="si">{e.query_string}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">entry</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntryPrinter.Custom"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.EntryPrinter.Custom">[docs]</a>    <span class="k">def</span> <span class="nf">Custom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">oss</span><span class="p">):</span>
        <span class="n">custom_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="n">account</span><span class="o">.</span><span class="n">TYPE</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;TRUE&#39;</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="s1">&#39;FALSE&#39;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">amount</span><span class="o">.</span><span class="n">Amount</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
            <span class="n">custom_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{e.date}</span><span class="s1"> custom &quot;</span><span class="si">{e.type}</span><span class="s1">&quot; </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">custom_values</span><span class="p">),</span>
                                                           <span class="n">e</span><span class="o">=</span><span class="n">entry</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_metadata</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">oss</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="format_entry"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.format_entry">[docs]</a><span class="k">def</span> <span class="nf">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format an entry into a string in the same input syntax the parser accepts.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: An entry instance.</span>
<span class="sd">      dcontext: An instance of DisplayContext used to format the numbers.</span>
<span class="sd">      render_weights: A boolean, true to render the weights for debugging.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the formatted entry.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">EntryPrinter</span><span class="p">(</span><span class="n">dcontext</span><span class="p">,</span> <span class="n">render_weights</span><span class="p">)(</span><span class="n">entry</span><span class="p">)</span></div>


<div class="viewcode-block" id="print_entry"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.print_entry">[docs]</a><span class="k">def</span> <span class="nf">print_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A convenience function that prints a single entry to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      entry: A directive entry.</span>
<span class="sd">      dcontext: An instance of DisplayContext used to format the numbers.</span>
<span class="sd">      render_weights: A boolean, true to render the weights for debugging.</span>
<span class="sd">      file: An optional file object to write the entries to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">dcontext</span><span class="p">,</span> <span class="n">render_weights</span><span class="p">))</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="print_entries"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.print_entries">[docs]</a><span class="k">def</span> <span class="nf">print_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">dcontext</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_weights</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A convenience function that prints a list of entries to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      entries: A list of directives.</span>
<span class="sd">      dcontext: An instance of DisplayContext used to format the numbers.</span>
<span class="sd">      render_weights: A boolean, true to render the weights for debugging.</span>
<span class="sd">      file: An optional file object to write the entries to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">&quot;Entries is not a list: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>
                      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="s1">&#39;buffer&#39;</span><span class="p">)</span> <span class="k">else</span>
                      <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="n">previous_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">entries</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">eprinter</span> <span class="o">=</span> <span class="n">EntryPrinter</span><span class="p">(</span><span class="n">dcontext</span><span class="p">,</span> <span class="n">render_weights</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="c1"># Insert a newline between transactions and between blocks of directives</span>
        <span class="c1"># of the same type.</span>
        <span class="n">entry_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">entry_type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Transaction</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Commodity</span><span class="p">)</span> <span class="ow">or</span>
            <span class="n">entry_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">previous_type</span><span class="p">):</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">previous_type</span> <span class="o">=</span> <span class="n">entry_type</span>

        <span class="n">string</span> <span class="o">=</span> <span class="n">eprinter</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></div>


<div class="viewcode-block" id="render_source"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.render_source">[docs]</a><span class="k">def</span> <span class="nf">render_source</span><span class="p">(</span><span class="n">meta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Render the source for errors in a way that it will be both detected by</span>
<span class="sd">    Emacs and align and rendered nicely.</span>

<span class="sd">    Args:</span>
<span class="sd">      meta: A dict with the metadata.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, rendered to be interpretable as a message location for Emacs or</span>
<span class="sd">      other editors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:</span><span class="si">{:8}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;lineno&#39;</span><span class="p">]))</span></div>


<div class="viewcode-block" id="format_error"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.format_error">[docs]</a><span class="k">def</span> <span class="nf">format_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given an error objects, return a formatted string for it.</span>

<span class="sd">    Args:</span>
<span class="sd">      error: a namedtuple objects representing an error. It has to have an</span>
<span class="sd">        &#39;entry&#39; attribute that may be either a single directive object or a</span>
<span class="sd">        list of directive objects.</span>
<span class="sd">    Returns:</span>
<span class="sd">      A string, the errors rendered.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">oss</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">render_source</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">source</span><span class="p">),</span> <span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">error</span><span class="o">.</span><span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">entry</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">entry</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">error</span><span class="o">.</span><span class="n">entry</span><span class="p">]</span>
        <span class="n">error_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">format_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">)</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">error_string</span><span class="p">,</span> <span class="s1">&#39;   &#39;</span><span class="p">))</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span></div>


<div class="viewcode-block" id="print_error"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.print_error">[docs]</a><span class="k">def</span> <span class="nf">print_error</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A convenience function that prints a single error to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      error: An error object.</span>
<span class="sd">      file: An optional file object to write the errors to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_error</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="print_errors"><a class="viewcode-back" href="../../../modules/parser/printer.html#beancount.parser.printer.print_errors">[docs]</a><span class="k">def</span> <span class="nf">print_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A convenience function that prints a list of errors to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">      errors: A list of errors.</span>
<span class="sd">      file: An optional file object to write the errors to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">format_error</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Beancount</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/index.html">Beancount Modules</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Martin Blais.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>